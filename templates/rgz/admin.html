<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>Кабинет Администратора</title>
    <link rel="icon" type="image/png" href="{{ url_for('static', filename='lab2/favicon.ico', v=2) }}">
    <style>
        body { font-family: sans-serif; padding: 20px; max-width: 1000px; margin: 0 auto; background-color: #f9f9f9; }
        h2 { border-bottom: 2px solid #333; padding-bottom: 10px; }
        .header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;}

        .add-form { background: white; padding: 20px; margin-bottom: 30px; border-radius: 8px; box-shadow: 0 2px 5px rgba(0,0,0,0.05); }
        .add-form input { margin: 5px; padding: 8px; border: 1px solid #ccc; border-radius: 4px; }

        table { width: 100%; border-collapse: collapse; margin-top: 20px; background: white; box-shadow: 0 2px 5px rgba(0,0,0,0.05); border-radius: 8px; overflow: hidden; }
        th, td { border-bottom: 1px solid #eee; padding: 12px 15px; text-align: left; vertical-align: middle; }
        th { background-color: #333; color: white; }
        tr:hover { background-color: #f1f1f1; }
        
        img.preview {
            width: 50px;
            height: 70px;
            object-fit: cover;
            border-radius: 4px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.2);
        }

        .actions {
            display: flex;
            gap: 10px; 
            align-items: center;
        }
        
        .btn {
            padding: 6px 12px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.9em;
            text-decoration: none;
            display: inline-block;
            text-align: center;
        }
        
        .btn-add { background: #28a745; color: white; padding: 10px 20px; font-size: 1em;}
        .btn-edit { background: #ffc107; color: #212529; } 
        .btn-del { background: #dc3545; color: white; }  
        
        .btn:hover { opacity: 0.85; }

        form.inline-form {
            margin: 0;
            padding: 0;
            display: flex;
        }
        .student-info { font-size: 0.9em; color: #666; margin-top: 5px; }
    </style>
</head>
<body>

<div class="header">
    <div class="header-top">
        <h1 style="margin: 0;">Управление книгами</h1>
        <div>
            <span>Вы вошли как: <b>admin</b></span> | 
            <a href="/rgz/">В каталог</a> | 
            <a href="/rgz/logout">Выйти</a>
        </div>
    </div>
    <div class="student-info">Студент: Привалова Таисия | Группа: ФБИ-33 | Вариант 8</div>
</div>

<div class="add-form">
    <h3>Добавить новую книгу</h3>
    <form action="/rgz/admin/add" method="POST" enctype="multipart/form-data">
        <input type="text" name="title" placeholder="Название" required>
        <input type="text" name="author" placeholder="Автор" required>
        <input type="number" name="pages" placeholder="Страниц" required>
        <input type="text" name="publisher" placeholder="Издательство" required>
        <br>
        <label>Обложка:</label>
        <input type="file" name="cover" accept="image/*">
        <br><br>
        <button type="submit" class="btn-add">Добавить книгу</button>
    </form>
</div>
<div style="background: #f8f9fa; padding: 15px; margin-bottom: 20px; border: 1px solid #dee2e6; border-radius: 8px;">
    <h4 style="margin-top: 0;">Поиск по списку</h4>
    <form method="GET" action="/rgz/admin" style="display: flex; gap: 10px; flex-wrap: wrap; align-items: flex-end;">
        <div style="display: flex; flex-direction: column;">
            <label style="font-size: 0.8em; font-weight: bold;">Название:</label>
            <input type="text" name="title" value="{{ search_title }}" placeholder="Часть названия..." style="padding: 5px; width: 200px; margin: 0;">
        </div>
        
        <div style="display: flex; flex-direction: column;">
            <label style="font-size: 0.8em; font-weight: bold;">Автор:</label>
            <input type="text" name="author" value="{{ search_author }}" placeholder="Имя автора..." style="padding: 5px; width: 200px; margin: 0;">
        </div>

        <button type="submit" style="background: #007bff; color: white; border: none; padding: 7px 15px; cursor: pointer; border-radius: 4px;">Найти</button>

        <a href="/rgz/admin" style="text-decoration: none;">
            <button type="button" style="background: #6c757d; color: white; border: none; padding: 7px 15px; cursor: pointer; border-radius: 4px;">Сбросить</button>
        </a>
    </form>
</div>
<h3>
    Последние добавленные книги 
    <span style="color: #777; font-size: 0.8em;">(Всего в базе: {{ books|length }})</span>
</h3>
<table>
    <thead>
        <tr>
            <th style="width: 50px;">ID</th>
            <th style="width: 70px;">Обложка</th>
            <th>Название</th>
            <th>Автор</th>
            <th style="width: 180px;">Действие</th>
        </tr>
    </thead>
    <tbody>
        {% for book in books %}
        <tr>
            <td>{{ book.id }}</td>
            <td>
                <img src="{{ book.cover_url }}" class="preview" 
                    onerror="this.src='/static/rgz/book_placeholder.jpg'">
            </td>
            <td><strong>{{ book.title }}</strong></td>
            <td>{{ book.author }}</td>
            <td>
                <div class="actions">
                    <a href="/rgz/admin/edit/{{ book.id }}" class="btn btn-edit">Изменить</a>

                    <form action="/rgz/admin/delete/{{ book.id }}" method="POST" class="inline-form" onsubmit="return confirm('Удалить книгу?');">
                        <button type="submit" class="btn btn-del">Удалить</button>
                    </form>
                </div>
            </td>
        </tr>
        {% endfor %}
    </tbody>
</table>

</body>
</html>